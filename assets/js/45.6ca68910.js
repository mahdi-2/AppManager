(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{409:function(a,e,s){"use strict";s.r(e);var r=s(25),t=Object(r.a)({},(function(){var a=this,e=a.$createElement,s=a._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"operacoes-de-aplicativo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#operacoes-de-aplicativo"}},[a._v("#")]),a._v(" Operações de Aplicativo")]),a._v(" "),s("p",[s("em",[a._v("Vá para a "),s("a",{attrs:{href:"https://github.com/MuntashirAkon/AppManager/issues/17",target:"_blank",rel:"noopener noreferrer"}},[a._v("questão relacionada"),s("OutboundLink")],1),a._v(" para discussão.")])]),a._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[a._v("Tabela de Conteúdos")]),a._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#plano-de-fundo"}},[a._v("Plano de Fundo")])]),s("li",[s("a",{attrs:{href:"#introducao-as-operacoes-de-aplicativo"}},[a._v("Introdução às Operações de Aplicativo")])]),s("li",[s("a",{attrs:{href:"#gerenciador-de-operacoes-de-aplicativo"}},[a._v("Gerenciador de Operações de Aplicativo")]),s("ul",[s("li",[s("a",{attrs:{href:"#constantes-op"}},[a._v("Constantes OP_*")])]),s("li",[s("a",{attrs:{href:"#constantes-mode"}},[a._v("Constantes MODE_*")])]),s("li",[s("a",{attrs:{href:"#pacote-de-operacoes"}},[a._v("Pacote de Operações")])]),s("li",[s("a",{attrs:{href:"#opentry"}},[a._v("OpEntry")])]),s("li",[s("a",{attrs:{href:"#uso"}},[a._v("Uso")])])])]),s("li",[s("a",{attrs:{href:"#servicos-de-operacoes-de-aplicativo"}},[a._v("Serviços de Operações de Aplicativo")])]),s("li",[s("a",{attrs:{href:"#appops-xml"}},[a._v("appops.xml")])]),s("li",[s("a",{attrs:{href:"#interface-de-linha-de-comando-appops"}},[a._v("interface de linha de comando appops")])])])]),s("p")]),a._v(" "),s("h2",{attrs:{id:"plano-de-fundo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#plano-de-fundo"}},[a._v("#")]),a._v(" Plano de Fundo")]),a._v(" "),s("p",[s("strong",[a._v("App Ops")]),a._v(" (abreviação para "),s("strong",[a._v("Operações de Aplicativo")]),a._v(") são usadas pelo sistema Android (desde o Android 4.3) para controlar as permissões do aplicativo. O usuário "),s("em",[a._v("pode")]),a._v(" controlar algumas permissões, mas apenas as permissões que são consideradas perigosas (e o Google acha que saber seu número de telefone não é uma coisa perigosa). Assim, as operações de aplicativo parecem ser o que precisamos se quisermos instalar aplicativos como o Facebook e o Messenger (que registra literalmente tudo) e ainda quiser ter "),s("em",[a._v("alguma")]),a._v(" privacidade e/ou segurança. Embora certas funções das operações de aplicativo estivessem disponíveis nas Configurações e mais tarde nas configurações ocultas na versão mais antiga do Android, isso está completamente escondido em versões mais recentes do Android e continuará a ser mantido escondido. Agora, qualquer aplicativo com a permissão "),s("strong",[a._v("android.Manifest.permission.GET_APP_OPS_STATS")]),a._v(" pode obter informações sobre as operações de aplicativo para outros aplicativos, mas essa permissão está oculta dos usuários e só pode ser ativada usando ADB ou root. Ainda assim, o aplicativo com essa permissão não pode conceder ou revogar permissões (na verdade modo de operação) para aplicativos que não sejam eles mesmos (com capacidade limitada, é claro). Para modificar as operações de outro aplicativo, o aplicativo precisa das permissões "),s("strong",[a._v("android.Manifest.permission.UPDATE_APP_OPS_STATS")]),a._v(" que não são acessíveis via comando "),s("em",[a._v("pm")]),a._v(". Assim, você não pode concedê-lo via root ou ADB, a permissão só é concedida aos aplicativos do sistema. Há muito poucos aplicativos que suportam desativar permissões via operações de aplicativo. O melhor que conheço é o "),s("a",{attrs:{href:"https://github.com/8enet/AppOpsX",target:"_blank",rel:"noopener noreferrer"}},[a._v("AppOpsX"),s("OutboundLink")],1),a._v(". A principal diferença (visível) entre meu aplicativo (AppManager) e este aplicativo é que o posterior também fornece a capacidade de revogar permissões de internet (escrevendo tabelas de ip). Outra diferença é que o autor usou a API oculta para acessar/conceder/revogar as operações, enquanto eu usei a ferramenta de linha de comando "),s("a",{attrs:{href:"#interface-de-linha-de-comando-appops"}},[s("em",[a._v("appops")])]),a._v(" para isso. Eu fiz isso por causa do limite de "),s("a",{attrs:{href:"https://stackoverflow.com/questions/37628",target:"_blank",rel:"noopener noreferrer"}},[a._v("Reflexão"),s("OutboundLink")],1),a._v(" que o Android recentemente impôs que tornou muitas APIs ocultas inutilizáveis (existem alguns hacks, mas eles podem não funcionar após o lançamento final do R, eu acredito). Um problema crucial que enfrentei durante o desenvolvimento de uma API para Operações de Aplicativo foi a falta de documentação em Inglês.")]),a._v(" "),s("h2",{attrs:{id:"introducao-as-operacoes-de-aplicativo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#introducao-as-operacoes-de-aplicativo"}},[a._v("#")]),a._v(" Introdução às Operações de Aplicativo")]),a._v(" "),s("img",{attrs:{src:a.$withBase("/assets/how_app_ops_work.png"),alt:"Como o AppOps Funciona"}}),a._v(" "),s("p",[a._v("A figura (tirada deste "),s("a",{attrs:{href:"https://translate.googleusercontent.com/translate_c?depth=2&pto=aue&rurl=translate.google.com&sl=auto&sp=nmt4&tl=en&u=https://www.cnblogs.com/0616--ataozhijia/p/5009718.html&usg=ALkJrhgSo4IcKp2cXJlqttXuiRJZGa_jnw",target:"_blank",rel:"noopener noreferrer"}},[a._v("artigo"),s("OutboundLink")],1),a._v(") acima descreve o processo de alteração e processamento de permissões. O "),s("a",{attrs:{href:"#gerenciador-de-operacoes-de-aplicativo"}},[s("strong",[a._v("Gerenciador de Operações de Aplicativo")])]),a._v(" pode ser usado para gerenciar permissões nas Configurações do aplicativo. O "),s("strong",[a._v("Gerenciador de Operações de Aplicativo")]),a._v(" também é útil para determinar se uma determinada permissão (ou operação) foi concedida ao aplicativo. A maioria dos métodos do "),s("strong",[a._v("Gerenciador de Operações de Aplicativo")]),a._v(" são acessíveis ao aplicativo do usuário, mas ao contrário de um aplicativo do sistema, ele só pode ser usado para verificar permissões para qualquer aplicativo ou para o próprio aplicativo e iniciar ou encerrar certas operações. Além disso, nem todas as operações são realmente acessíveis a partir desta classe Java. O "),s("strong",[a._v("Gerenciador de Operações de Aplicativo")]),a._v(" detém todas as constantes necessárias, como "),s("a",{attrs:{href:"#constantes-op"}},[s("em",[a._v("OP_*")])]),a._v(", "),s("code",[a._v("OPSTR_*")]),a._v(", "),s("a",{attrs:{href:"#constantes-mode"}},[s("em",[a._v("MODE_*")])]),a._v(" que descreve código de operação, sequência de operação e modo de operações, respectivamente. Também mantém estuturas de dados necessárias, como "),s("a",{attrs:{href:"#pacote-de-operacoes"}},[s("strong",[a._v("PackageOps")])]),a._v(" e "),s("strong",[a._v("OpEntry")]),a._v(". "),s("strong",[a._v("PackageOps")]),a._v(" mantém "),s("strong",[a._v("OpEntry")]),a._v(" para um pacote, e "),s("strong",[a._v("OpEntry")]),a._v(", como o nome sugere, descreve cada operação. Por baixo dos panos, o "),s("strong",[a._v("Gerenciador de Operações de Aplicativo")]),a._v(" chama o "),s("strong",[a._v("Serviço de Operações de Aplicativo")]),a._v(" para realizar qualquer trabalho real.")]),a._v(" "),s("p",[a._v("O "),s("a",{attrs:{href:"https://android.googlesource.com/platform/frameworks/base/+/master/services/core/java/com/android/server/appop/AppOpsService.java",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[a._v("Serviço de Operações de Aplicativo")]),s("OutboundLink")],1),a._v(" é completamente oculto de um aplicativo de usuário, mas acessível para os aplicativos do sistema. Como visto na foto, esta é a classe que realmente gerencía as coisas. Contém estruturas de dados como "),s("strong",[a._v("Ops")]),a._v(" para armazenar informações básicas do pacote e "),s("strong",[a._v("Op")]),a._v(" que é semelhante a "),s("strong",[a._v("OpEntry")]),a._v(" do "),s("strong",[a._v("Gerenciador de Operações de Aplicativo")]),a._v(". Ele também tem "),s("strong",[a._v("Shell")]),a._v(" que é, na verdade, o código fonte da ferramenta de linha de comando "),s("em",[a._v("appops")]),a._v(". Ele grava configurações para ou lê configurações do "),s("a",{attrs:{href:"#appops-xml"}},[a._v("/data/system/appops.xml")]),a._v(". Os serviços do sistema chama o "),s("strong",[a._v("Serviço de Operações de Aplicativo")]),a._v(" para descobrir o que um aplicativo é permitido e o que não é permitido realizar, e o "),s("strong",[a._v("Serviço de Operações de Aplicativo")]),a._v(" determina essas permissões analisando "),s("code",[a._v("/data/system/appops.xml")]),a._v(". Se nenhum valor personalizado for definido em "),s("em",[a._v("appops.xml")]),a._v(", ele retorna ao modo padrão disponível no "),s("strong",[a._v("Gerenciador de Operações de Aplicativo")]),a._v(".")]),a._v(" "),s("h2",{attrs:{id:"gerenciador-de-operacoes-de-aplicativo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gerenciador-de-operacoes-de-aplicativo"}},[a._v("#")]),a._v(" Gerenciador de Operações de Aplicativo")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/app/AppOpsManager.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("AppOpsManager"),s("OutboundLink")],1),a._v(" significa gerenciador de operações de aplicativo. Consiste em várias constantes e classes para modificar as operações de aplicativo. A documentação oficial pode ser encontrada "),s("a",{attrs:{href:"https://developer.android.com/reference/android/app/AppOpsManager",target:"_blank",rel:"noopener noreferrer"}},[a._v("aqui"),s("OutboundLink")],1),a._v(".")]),a._v(" "),s("h3",{attrs:{id:"constantes-op"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#constantes-op"}},[a._v("#")]),a._v(" Constantes OP_*")]),a._v(" "),s("p",[s("code",[a._v("OP_*")]),a._v(" são as constantes inteiras a partir de "),s("code",[a._v("0")]),a._v(". "),s("code",[a._v("OP_NONE")]),a._v(" implica que nenhuma operação é especificada, enquanto "),s("code",[a._v("_NUM_OP")]),a._v(" denota o número de operações definidas no prefixo "),s("code",[a._v("OP_*")]),a._v(".  Isso denota cada operação. Mas essas operações não são necessariamente únicas. Na verdade, há muitas operações que são realmente uma única operação denotada por múltiplas constantes "),s("code",[a._v("OP_*")]),a._v(" (possivelmente para uso futuro). Os fornecedores podem definir sua própria operação com base em suas necessidades. A MIUI é um dos fornecedores que são conhecidos por fazer isso.")]),a._v(" "),s("p",[s("em",[a._v("Uma pequena espiada sobre "),s("code",[a._v("OP_*")]),a._v(":")])]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("div",{staticClass:"highlight-lines"},[s("div",{staticClass:"highlighted"},[a._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[a._v(" ")]),s("br")]),s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" OP_NONE "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" OP_COARSE_LOCATION "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" OP_FINE_LOCATION "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" OP_GPS "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" OP_VIBRATE "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" OP_READ_DEVICE_IDENTIFIERS "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("89")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" OP_ACCESS_MEDIA_LOCATION "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("90")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" OP_ACTIVATE_PLATFORM_VPN "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("91")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" _NUM_OP "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("92")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("p",[a._v("Se uma operação é única, é definida por "),s("a",{attrs:{href:"https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/app/AppOpsManager.java;drc=44cbdec292c6b234d94aae59257721cf499989ba;bpv=1;bpt=1;l=211?q=AppOpsManager&ss=android%2Fplatform%2Fsuperproject&gsn=sOpToSwitch&gs=kythe%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fsuperproject%3Flang%3Djava%3Fpath%3Dandroid.app.AppOpsManager%238ffb80c9b09fce58d7fe1a0af7d50fd025765d8f41e838fa3bc2754dd99d9c48",target:"_blank",rel:"noopener noreferrer"}},[s("code",[a._v("sOpToSwitch")]),s("OutboundLink")],1),a._v(". Ele mapeia cada operação para outra operação ou para si mesma (se for uma operação única). Por exemplo,, "),s("code",[a._v("OP_FINE_LOCATION")]),a._v(" e "),s("code",[a._v("OP_GPS")]),a._v(" são mapeadas para "),s("code",[a._v("OP_COARSE_LOCATION")]),a._v(".")]),a._v(" "),s("p",[a._v("Cada operação tem um nome privado que são descritos por "),s("a",{attrs:{href:"https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/app/AppOpsManager.java;drc=44cbdec292c6b234d94aae59257721cf499989ba;bpv=1;bpt=1;l=311?gsn=sOpNames&gs=kythe%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fsuperproject%3Flang%3Djava%3Fpath%3Dandroid.app.AppOpsManager%234f77b221ad3e5d9212e217eadec0b78cd35717a3bf2d0f2bc642dea241e02d72",target:"_blank",rel:"noopener noreferrer"}},[s("code",[a._v("sOpNames")]),s("OutboundLink")],1),a._v(". Esses nomes são geralmente os mesmos nomes das constantes sem o prefixo "),s("code",[a._v("OP_")]),a._v(". Algumas operações têm nomes públicos, bem como que são descritos por "),s("code",[a._v("sOpToString")]),a._v(". Por exemplo, "),s("code",[a._v("OP_COARSE_LOCATION")]),a._v(" tem o nome público "),s("strong",[a._v("android:coarse_location")]),a._v(".")]),a._v(" "),s("p",[a._v("Como um processo gradual de movimentação de permissões para operações de aplicativo, já existem muitas permissões que são definidas em algumas operações. Essas permissões são mapeadas em "),s("a",{attrs:{href:"https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/app/AppOpsManager.java;drc=44cbdec292c6b234d94aae59257721cf499989ba;bpv=1;bpt=1;l=361?gsn=sOpPerms&gs=kythe%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fsuperproject%3Flang%3Djava%3Fpath%3Dandroid.app.AppOpsManager%23230bc1462b07a3c1575477761782a9d3537d75b4ea0a16748082c74f50bc2814",target:"_blank",rel:"noopener noreferrer"}},[s("code",[a._v("sOpPerms")]),s("OutboundLink")],1),a._v(". Por exemplo, a permissão "),s("strong",[a._v("android.Manifest.permission.ACCESS_COARSE_LOCATION")]),a._v(" é mapeada para "),s("code",[a._v("OP_COARSE_LOCATION")]),a._v(". Algumas operações podem não ter quaisquer permissões associadas que tenham valores "),s("code",[a._v("null")]),a._v(".")]),a._v(" "),s("p",[a._v("Como descrito na seção anterior, as operações configuradas para um aplicativo são armazenadas em "),s("a",{attrs:{href:"#appops-xml"}},[a._v("/data/system/appops.xml")]),a._v(". Se uma operação não estiver configurada, então o sistema permitirá que essa operação seja determinada a partir de "),s("a",{attrs:{href:"https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/app/AppOpsManager.java;drc=44cbdec292c6b234d94aae59257721cf499989ba;bpv=1;bpt=1;l=410?gsn=sOpDefaultMode&gs=kythe%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fsuperproject%3Flang%3Djava%3Fpath%3Dandroid.app.AppOpsManager%23a8c8e4e247453a8ce329b2c1130f9c7a7f91e2b97d159c3e18c768b4d42f1b75",target:"_blank",rel:"noopener noreferrer"}},[s("code",[a._v("sOpDefaultMode")]),s("OutboundLink")],1),a._v(". Ele lista o "),s("em",[a._v("modo padrão")]),a._v(" para cada operação.")]),a._v(" "),s("h3",{attrs:{id:"constantes-mode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#constantes-mode"}},[a._v("#")]),a._v(" Constantes MODE_*")]),a._v(" "),s("p",[a._v("Constantes "),s("code",[a._v("MODE_*")]),a._v(" também constantes inteiras a partir de "),s("code",[a._v("0")]),a._v(". Essas constantes são atribuídas a cada operação descrevendo se um aplicativo está autorizado a realizar essa operação. Esses modos geralmente têm nomes associados, como "),s("strong",[a._v("allow")]),a._v(" para "),s("code",[a._v("MODE_ALLOWED")]),a._v(", "),s("strong",[a._v("ignore")]),a._v(" para "),s("code",[a._v("MODE_IGNORED")]),a._v(", "),s("strong",[a._v("deny")]),a._v(" para "),s("code",[a._v("MODE_ERRORED")]),a._v(" (um termo um pouco errado), "),s("strong",[a._v("default")]),a._v(" para "),s("code",[a._v("MODE_DEFAULT")]),a._v(" e "),s("strong",[a._v("foreground")]),a._v(" para "),s("code",[a._v("MODE_FOREGROUND")]),a._v(".")]),a._v(" "),s("p",[s("em",[a._v("Modos padrão:")])]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n * o chamador fornecido é autorizado a realizar a operação fornecida.\n */")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" MODE_ALLOWED "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n * o chamador fornecido não está autorizado a realizar a operação fornecida, e esta tentativa deve\n * <em>falhar silenciosamente</em> (ele não deve fazer com que o aplicativo caia).\n */")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" MODE_IGNORED "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n * o chamador fornecido não está autorizado a realizar a operação fornecida, e esta tentativa deve\n * porque ele tem um erro fatal, tipicamente um {@link SecurityException}.\n */")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" MODE_ERRORED "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 2")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n * o chamador deve usar sua verificação de segurança padrão. Este modo não é normalmente usado\n */")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" MODE_DEFAULT "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('/**\n * Modo especial que significa "permitir apenas quando o aplicativo estiver em primeiro plano."\n */')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" MODE_FOREGROUND "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br")])]),s("p",[a._v("Além desses modos padrão, os fornecedores podem definir modos personalizados, como "),s("code",[a._v("MODE_ASK")]),a._v(" (com o nome "),s("strong",[a._v("ask")]),a._v(") que é usado ativamente pela MIUI. A MIUI também usa alguns outros modos sem qualquer nome associado a eles.")]),a._v(" "),s("h3",{attrs:{id:"pacote-de-operacoes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pacote-de-operacoes"}},[a._v("#")]),a._v(" Pacote de Operações")]),a._v(" "),s("p",[s("strong",[a._v("AppOpsManager.PackageOps")]),a._v(" é uma estrutura de dados para armazenar todos as "),s("strong",[a._v("OpEntry")]),a._v(" para um pacote. Em termos simples, armazena todas as operações personalizadas para um pacote.")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PackageOps")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("implements")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Parcelable")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" mPackageName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" mUid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OpEntry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" mEntries"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("Como pode ser visto acima, ele armazena todas as "),s("strong",[a._v("OpEntry")]),a._v(" para um pacote, bem como o nome do pacote correspondente e seu ID de usuário do kernel.")]),a._v(" "),s("h3",{attrs:{id:"opentry"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#opentry"}},[a._v("#")]),a._v(" OpEntry")]),a._v(" "),s("p",[s("strong",[a._v("AppOpsManager.OpEntry")]),a._v(" é uma estrutura de dados que armazena uma única operação para qualquer pacote.")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OpEntry")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("implements")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Parcelable")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" mOp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("boolean")]),a._v(" mRunning"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Mode")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" mMode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Nullable")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LongSparseLongArray")]),a._v(" mAccessTimes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Nullable")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LongSparseLongArray")]),a._v(" mRejectTimes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Nullable")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LongSparseLongArray")]),a._v(" mDurations"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Nullable")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LongSparseLongArray")]),a._v(" mProxyUids"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Nullable")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LongSparseArray")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" mProxyPackageNames"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])]),s("p",[a._v("Aqui:")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("mOp")]),a._v(": Denota uma das constantes "),s("a",{attrs:{href:"#constantes-op"}},[s("code",[a._v("OP_*")])]),a._v(".")]),a._v(" "),s("li",[s("code",[a._v("mRunning")]),a._v(": Se as operações estão em andamento (ou seja, a operação começou, mas ainda não terminou). Nem todas as operações podem ser iniciadas ou concluídas assim.")]),a._v(" "),s("li",[s("code",[a._v("mMOde")]),a._v(": Uma das constantes "),s("a",{attrs:{href:"#constantes-mode"}},[s("code",[a._v("MODE_*")])]),a._v(".")]),a._v(" "),s("li",[s("code",[a._v("mAccessTimes")]),a._v(": Armazena todos os horários de acesso disponíveis")]),a._v(" "),s("li",[s("code",[a._v("mRejectTimes")]),a._v(": Armazena todos os horários de rejeição disponíveis")]),a._v(" "),s("li",[s("code",[a._v("mDurations")]),a._v(": Todas as durações de acesso disponíveis, verificando isso com "),s("code",[a._v("mRunning")]),a._v(" lhe dirá por quanto tempo o aplicativo está realizando uma determinada operação de aplicativo.")]),a._v(" "),s("li",[s("code",[a._v("mProxyUids")]),a._v(": Nenhuma documentação encontrada")]),a._v(" "),s("li",[s("code",[a._v("mProxyPackageNames:")]),a._v(" Nenhuma documentação encontrada")])]),a._v(" "),s("h3",{attrs:{id:"uso"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#uso"}},[a._v("#")]),a._v(" Uso")]),a._v(" "),s("p",[a._v("TAREFAS")]),a._v(" "),s("h2",{attrs:{id:"servicos-de-operacoes-de-aplicativo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#servicos-de-operacoes-de-aplicativo"}},[a._v("#")]),a._v(" Serviços de Operações de Aplicativo")]),a._v(" "),s("p",[a._v("TAREFAS")]),a._v(" "),s("h2",{attrs:{id:"appops-xml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#appops-xml"}},[a._v("#")]),a._v(" appops.xml")]),a._v(" "),s("p",[a._v("As últimas "),s("code",[a._v("appops.xml")]),a._v(" tem o seguinte formato: (Este DTD é feito por mim e não está perfeito, tem problemas de compatibilidade.)")]),a._v(" "),s("div",{staticClass:"language-dtd line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("<!DOCTYPE app-ops [\n\n<!ELEMENT app-ops (uid|pkg)*>\n<!ATTLIST app-ops v CDATA #IMPLIED>\n\n<!ELEMENT uid (op)*>\n<!ATTLIST uid n CDATA #REQUIRED>\n\n<!ELEMENT pkg (uid)*>\n<!ATTLIST pkg n CDATA #REQUIRED>\n\n<!ELEMENT uid (op)*>\n<!ATTLIST uid\nn CDATA #REQUIRED\np CDATA #IMPLIED>\n\n<!ELEMENT op (st)*>\n<!ATTLIST op\nn CDATA #REQUIRED\nm CDATA #REQUIRED>\n\n<!ELEMENT st EMPTY>\n<!ATTLIST st\nn CDATA #REQUIRED\nt CDATA #IMPLIED\nr CDATA #IMPLIED\nd CDATA #IMPLIED\npp CDATA #IMPLIED\npu CDATA #IMPLIED>\n\n]>\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br")])]),s("p",[a._v("As instruções abaixo seguem a ordem exata dada acima:")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("app-ops")]),a._v(": O elemento root. Ele pode conter qualquer número de "),s("code",[a._v("pkg")]),a._v(" ou pacote "),s("code",[a._v("uid")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("v")]),a._v(": (opcional, número inteiro) O número da versão (padrão: "),s("code",[a._v("NO_VERSION")]),a._v(" ou "),s("code",[a._v("-1")]),a._v(")")])])]),a._v(" "),s("li",[s("code",[a._v("pkg")]),a._v(": Armazena informações do pacote. Ele pode conter qualquer número do "),s("code",[a._v("uid")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("n")]),a._v(": (necessário, string) Nome do pacote")])])]),a._v(" "),s("li",[a._v("Pacote "),s("code",[a._v("uid")]),a._v(": Pacotes de lojas ou informações sobre pacotes\n"),s("ul",[s("li",[s("code",[a._v("n")]),a._v(": (necessário, número inteiro) O ID do usuário")])])]),a._v(" "),s("li",[s("code",[a._v("uid")]),a._v(": O ID do pacote do usuário. Ele pode conter qualquer número de "),s("code",[a._v("op")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("n")]),a._v(": (necessário, número inteiro) O ID do usuário")]),a._v(" "),s("li",[s("code",[a._v("p")]),a._v(": (optional, boolean) Se o aplicativo é um aplicativo privado/do sistema")])])]),a._v(" "),s("li",[s("code",[a._v("op")]),a._v(": A operação pode conter "),s("code",[a._v("st")]),a._v(" ou nada\n"),s("ul",[s("li",[s("code",[a._v("n")]),a._v(": (necessário, número inteiro) O nome da operação em inteiro, ou seja. AppOpsManager.OP_*")]),a._v(" "),s("li",[s("code",[a._v("m")]),a._v(": (necessário, número inteiro) O modo da operação, ou seja. AppOpsManager.MODE_*")])])]),a._v(" "),s("li",[s("code",[a._v("st")]),a._v(": Estado de funcionamento: se a operação é acessada, rejeitada ou em execução (não disponível em versões antigas)\n"),s("ul",[s("li",[s("code",[a._v("n")]),a._v(": (necessário, longo) Chave contendo flags e uid")]),a._v(" "),s("li",[s("code",[a._v("t")]),a._v(": (opcional, longo) Tempo de acesso (padrão: "),s("code",[a._v("0")]),a._v(")")]),a._v(" "),s("li",[s("code",[a._v("r")]),a._v(": (opcional, longo) Tempo de rejeição (padrão: "),s("code",[a._v("0")]),a._v(")")]),a._v(" "),s("li",[s("code",[a._v("d")]),a._v(": (opcional, longo) Duração do acesso (padrão: "),s("code",[a._v("0")]),a._v(")")]),a._v(" "),s("li",[s("code",[a._v("pp")]),a._v(": (opcional, string) Nome do pacote proxy")]),a._v(" "),s("li",[s("code",[a._v("pu")]),a._v(": (opcional, número inteiro) Pacote uid do proxy")])])])]),a._v(" "),s("p",[a._v("Esta definição pode ser encontrada em "),s("a",{attrs:{href:"https://android.googlesource.com/platform/frameworks/base/+/master/services/core/java/com/android/server/appop/AppOpsService.java",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[a._v("AppOpsService")]),s("OutboundLink")],1),a._v(".")]),a._v(" "),s("h2",{attrs:{id:"interface-de-linha-de-comando-appops"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#interface-de-linha-de-comando-appops"}},[a._v("#")]),a._v(" interface de linha de comando appops")]),a._v(" "),s("p",[s("code",[a._v("appops")]),a._v(" ou "),s("code",[a._v("cmd appops")]),a._v(" (nas versões mais recentes) pode ser acessado via ADB ou root. Este é um método mais fácil de obter ou atualizar qualquer operação para um pacote (desde que o nome do pacote seja conhecido). A página de ajuda deste comando é auto explicativa:")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("Comandos do serviço de Operações de Aplicativo (appops):\nhelp\n  Escreva este texto para receber ajuda.\nstart [--user <USER_ID>] <PACKAGE | UID> <OP> \n  Inicia uma determinada operação para um determinado aplicativo.\nstop [--user <USER_ID>] <PACKAGE | UID> <OP> \n  Interrompe uma determinada operação para um determinado aplicativo.\nset [--user <USER_ID>] <[--uid] PACKAGE | UID> <OP> <MODE>\n  Define o modo para um determinado aplicativo e operação.\nget [--user <USER_ID>] <PACKAGE | UID> [<OP>]\n  Retorne o modo para um determinado aplicativo e operação opcional.\nquery-op [--user <USER_ID>] <OP> [<MODE>]\n  Imprime todos os pacotes que atualmente possuem a operação fornecida no modo fornecido.\nreset [--user <USER_ID>] [<PACKAGE>]\n  Redefine o aplicativo ou todos os aplicativos para os modos padrão.\nwrite-settings\n  Grava imediatamente as alterações pendentes no armazenamento.\nread-settings\n  Lê as últimas configurações escritas, substituindo o estado atual em RAM.\nopções:\n  <PACKAGE> um nome de pacote Android ou seu UID se prefixado por --uid\n  <OP>      uma operação das Operações de aplicativo.\n  <MODE>    um de permitir, ignorar, negar ou padrão\n  <USER_ID> o id do usuário sob o qual o pacote está instalado. Se --user não for\n            especificado, o usuário atual é assumido.\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br")])])])}),[],!1,null,null,null);e.default=t.exports}}]);